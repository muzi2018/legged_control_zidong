<?xml version="1.0"?>

<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

    <xacro:include filename="$(find legged_unitree_description)/urdf/common/transmission.xacro"/>

    <xacro:macro name="leg" params="prefix mirror mirror_dae front_hind front_hind_dae *origin">

        <joint name="${prefix}_JHipRz" type="revolute">
            <xacro:insert_block name="origin"/>
            <parent link="base"/>
            <child link="${prefix}_LHipRz"/>
            <axis xyz="0 0 1"/>
            <dynamics damping="${damping}" friction="${friction}"/>
            <limit effort="${hip_torque_max}" velocity="${hip_velocity_max}" lower="${hip_min}" upper="${hip_max}"/>
        </joint>

        <link name="${prefix}_LHipRz">
            <visual>
                <origin rpy="0 0 0.0" xyz="0 0 0"/>
                <geometry>
                    <mesh filename="package://legged_unitree_description/meshes/$(arg robot_type)/${prefix}_HipRz.obj"
                            scale="1 1 1"/>
                </geometry>
                <material name="orange"/>
            </visual>
            <inertial>
                <origin rpy="0 0 0" xyz="0.0 0.0 -0.01"/>
                <mass value="0.30"/>
                <inertia
                        ixx="0.003735" ixy="0.0" ixz="0.0"
                        iyy="0.01391" iyz="0.0"
                        izz="0.01355"/>
            </inertial>
        </link>

        <joint name="${prefix}_JHipRx" type="revolute">
            <origin rpy="0 0 0" xyz="-0.041 0.0 -0.0885"/>
            <parent link="${prefix}_LHipRz"/>
            <child link="${prefix}_LHipRx"/>
            <axis xyz="1 0 0"/>
            <dynamics damping="${damping}" friction="${friction}"/>
            <limit effort="${hip_torque_max}" velocity="${hip_velocity_max}" lower="${hip_min}"
                   upper="${hip_max}"/>
        </joint>

        <link name="${prefix}_LHipRx">
            <collision>
            <xacro:if value="${(mirror == True)}">
                <origin rpy="0 ${HipRx_ry_offset} 0" xyz="${HipRx_x_offset} ${HipRx_y_offset} ${HipRx_z_offset}"/>
            </xacro:if>
            <xacro:unless value="${(mirror == False)}">
                <origin rpy="0 ${HipRx_ry_offset} 0" xyz="${HipRx_x_offset} ${-HipRx_y_offset} ${HipRx_z_offset}"/>
            </xacro:unless>
                <geometry>
                    <cylinder length="${HipRx_length}" radius="${HipRx_radius}"/>
                </geometry>
            </collision>
            <visual>
                <xacro:if value="${(mirror == True)}">
                    <origin rpy="0 0 0" xyz="0. 0.00 0.0"/>
                </xacro:if>
                <xacro:unless value="${(mirror == False)}">
                    <origin rpy="0 0 0.0" xyz="0 0 0.0"/>
                </xacro:unless>
                <geometry>
                    <mesh filename="package://legged_unitree_description/meshes/$(arg robot_type)/${prefix}_HipRx.obj"
                            scale="1 1 1"/>
                </geometry>
                <material name="orange"/>
            </visual>
            <inertial>
                <origin rpy="0 0 0" xyz="0.0 0.0 -0.01"/>
                <mass value="0.30"/>
                <inertia
                        ixx="0.003735" ixy="0.0" ixz="0.0"
                        iyy="0.01391" iyz="0.0"
                        izz="0.01355"/>
            </inertial>
        </link>

        <joint name="${prefix}_JThigh" type="revolute">
            <origin rpy="0 0 0" xyz="0.065 0.0 0.0"/>
            <parent link="${prefix}_LHipRx"/>
            <child link="${prefix}_LThigh"/>
            <axis xyz="0 1 0"/>
            <dynamics damping="${damping}" friction="${friction}"/>
            <limit effort="${hip_torque_max}" velocity="${hip_velocity_max}" lower="${hip_min}"
                   upper="${hip_max}"/>
        </joint>

        <link name="${prefix}_LThigh">
            <visual>
                <xacro:if value="${(mirror == True)}">
                    <origin rpy="1.57 1.57 -0" xyz="0. 0.0 0.0"/>
                </xacro:if>
                <xacro:unless value="${(mirror == False)}">
                    <origin rpy="1.57 1.57 0.0" xyz="0 0.0 0.0"/>
                </xacro:unless>
                <geometry>
                    <mesh filename="package://legged_unitree_description/meshes/$(arg robot_type)/${prefix}_Thigh.obj"
                            scale="1 1 1"/>
                </geometry>
                <material name="orange"/>
            </visual>
            <collision>
            <xacro:if value="${(mirror == True)}">
                <origin rpy="0 0 0" xyz="${Thigh_x_offset} ${Thigh_y_offset} ${Thigh_z_offset}"/>
            </xacro:if>
            <xacro:unless value="${(mirror == False)}">
                <origin rpy="0 0 0" xyz="${Thigh_x_offset} ${-Thigh_y_offset} ${Thigh_z_offset}"/>
            </xacro:unless>
                <geometry>
                    <cylinder length="${Thigh_length}" radius="${Thigh_radius}"/>
                </geometry>
            </collision>
            <inertial>
                <origin rpy="0 0 0" xyz="0.0 0.0 -0.01"/>
                <mass value="1.0"/>
                <inertia
                        ixx="0.003735" ixy="0.0" ixz="0.0"
                        iyy="0.01391" iyz="0.0"
                        izz="0.01355"/>
            </inertial>
        </link>

        <joint name="${prefix}_JKnee" type="revolute">
            <origin rpy="0 0 0" xyz="0.0 ${-0.017875*mirror} -0.247"/>
            <parent link="${prefix}_LThigh"/>
            <child link="${prefix}_LShank"/>
            <axis xyz="0 1 0"/>
            <dynamics damping="${damping}" friction="${friction}"/>
            <limit effort="${hip_torque_max}" velocity="${hip_velocity_max}" lower="${hip_min}"
                   upper="${hip_max}"/>
        </joint>

        <link name="${prefix}_LShank">
            <visual>
                <origin rpy="1.57 1.57 0" xyz="0 -0.0 0"/>
                <geometry>
                    <mesh filename="package://legged_unitree_description/meshes/$(arg robot_type)/${prefix}_LowerLeg3_drawing.obj"
                            scale="1 1 1"/>
                </geometry>
                <material name="orange"/>
            </visual>
            <collision>
            <xacro:if value="${(mirror == True)}">
                <origin rpy="0 0 0" xyz="${Shank_x_offset} ${Shank_y_offset} ${Shank_z_offset}"/>
            </xacro:if>
            <xacro:unless value="${(mirror == False)}">
                <origin rpy="0 0 0" xyz="${Shank_x_offset} ${-Shank_y_offset} ${Shank_z_offset}"/>
            </xacro:unless>
                <geometry>
                    <cylinder length="${Shank_length}" radius="${Shank_radius}"/>
                </geometry>
            </collision>
            <inertial>
                <origin rpy="0 0 0" xyz="-0.03416 -0.00075 -0.01"/>
                <mass value="0.70"/>
                <inertia
                        ixx="0.003735" ixy="0.0" ixz="0.0"
                        iyy="0.01391" iyz="0.0"
                        izz="0.01355"/>
            </inertial>
        </link>

        <joint name="${prefix}_JAnkle" type="revolute">
            <origin rpy="0 0 0" xyz="0.0 0.0 -0.247"/>
            <parent link="${prefix}_LShank"/>
            <child link="${prefix}_Foot"/>
            <axis xyz="0 1 0"/>
            <dynamics damping="${damping}" friction="${friction}"/>
            <limit effort="${hip_torque_max}" velocity="${hip_velocity_max}" lower="${hip_min}"
                   upper="${hip_max}"/>
        </joint>

        <link name="${prefix}_Foot">
            <visual>
                <origin rpy="1.57 1.57 0" xyz="0 0 0"/>
                <geometry>
                    <mesh filename="package://legged_unitree_description/meshes/$(arg robot_type)/${prefix}_foot_drawing.obj"
                            scale="1 1 1"/>
                </geometry>
                <material name="orange"/>
            </visual>

            <!-- <collision>
                <geometry>
                    <sphere radius="0.02"/>
                </geometry>
                <origin xyz="-0.1 0.0 -0.03" rpy="0 0 0"/>
            </collision> 
            <collision>
                <geometry>
                    <sphere radius="0.02"/>
                </geometry>
                <origin xyz="0.12 0.0 -0.03" rpy="0 0 0"/>
            </collision>  -->

            <collision>
                <origin rpy="0 0 0" xyz="0 0 -0.033"/>
                <geometry>
                    <box size="${foot_width} ${foot_length} ${foot_height}"/>
                </geometry>
            </collision>            


            <!-- <collision>
            <xacro:if value="${(mirror == True)}">
                <origin rpy="0 0 0" xyz="${foot_width} ${Shank_y_offset} ${Shank_z_offset}"/>
            </xacro:if>
            <xacro:unless value="${(mirror == False)}">
                <origin rpy="0 0 0" xyz="${Shank_x_offset} ${-Shank_y_offset} ${Shank_z_offset}"/>
            </xacro:unless>
                <geometry>
                    <cylinder length="${Shank_length}" radius="${Shank_radius}"/>
                </geometry>
            </collision> -->



            <inertial>
                <origin rpy="0 0 0" xyz="0.0 0.0 -0.01"/>
                <mass value="0.30"/>
                <inertia
                        ixx="0.003735" ixy="0.0" ixz="0.0"
                        iyy="0.01391" iyz="0.0"
                        izz="0.01355"/>
            </inertial>
        </link>

        <gazebo reference="${prefix}_LHipRz">
            <mu1>0.2</mu1>
            <mu2>0.2</mu2>
            <material>Gazebo/DarkGrey</material>
            <kp value="1000000.0"/>
            <kd value="100.0"/>
        </gazebo>
        <gazebo reference="${prefix}_LHipRx">
            <mu1>0.2</mu1>
            <mu2>0.2</mu2>
            <material>Gazebo/DarkGrey</material>
            <kp value="1000000.0"/>
            <kd value="100.0"/>
        </gazebo>
        <gazebo reference="${prefix}_LThigh">
            <mu1>0.2</mu1>
            <mu2>0.2</mu2>
            <material>Gazebo/DarkGrey</material>
            <kp value="1000000.0"/>
            <kd value="100.0"/>
        </gazebo>
        <gazebo reference="${prefix}_LShank">
            <mu1>0.2</mu1>
            <mu2>0.2</mu2>
            <material>Gazebo/DarkGrey</material>
            <kp value="1000000.0"/>
            <kd value="100.0"/>
        </gazebo>
        <gazebo reference="${prefix}_Foot">
            <mu1>0.6</mu1>
            <mu2>0.6</mu2>
            <material>Gazebo/DarkGrey</material>
            <kp value="1000000.0"/>
            <kd value="100.0"/>
        </gazebo>
        <xacro:leg_transmission name="${prefix}"/>
    </xacro:macro>
</robot>
