<?xml version="1.0"?>

<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

    <xacro:include filename="$(find legged_unitree_description)/urdf/common/arm_transmission.xacro"/>

    <xacro:macro name="arm" params="prefix mirror mirror_dae front_hind front_hind_dae *origin">

        <joint name="${prefix}_JShoulderRx" type="revolute">
            <xacro:insert_block name="origin"/>
            <parent link="base"/>
            <child link="${prefix}_LShoulderRx"/>
            <axis xyz="1 0 0"/>
            <dynamics damping="${damping}" friction="${friction}"/>
            <limit effort="${hip_torque_max}" velocity="${hip_velocity_max}" lower="${hip_min}" upper="${hip_max}"/>
        </joint>
        <link name="${prefix}_LShoulderRx">
            <visual>
                <xacro:if value="${(mirror == True)}">
                    <origin rpy="3.14 0 -1.570" xyz="0.006 -0.005 -0.034"/>
                </xacro:if>
                <xacro:unless value="${(mirror == False)}">
                    <origin rpy="3.14 0 -1.570" xyz="0.006 0.005 -0.034"/>
                </xacro:unless>
                <geometry>
                    <mesh filename="package://legged_unitree_description/meshes/$(arg robot_type)/L_ShoulderRx.obj"
                            scale="1 1 1"/>
                </geometry>
                <material name="red"/>
            </visual>
            <collision>
            <xacro:if value="${(mirror == True)}">
                <origin rpy="0 ${shoudlerarm_ry_offset} 0" xyz="${shoudlerarm_x_offset} ${shoudlerarm_y_offset} ${shoudlerarm_z_offset}"/>
            </xacro:if>
            <xacro:unless value="${(mirror == False)}">
                <origin rpy="0 ${shoudlerarm_ry_offset} 0" xyz="${shoudlerarm_x_offset} ${-shoudlerarm_y_offset} ${shoudlerarm_z_offset}"/>
            </xacro:unless>
                <geometry>
                    <cylinder length="${shoudlerarm_length}" radius="${shoudlerarm_radius}"/>
                </geometry>
            </collision>
            <inertial>
                <origin rpy="0 0 0" xyz="0.0 0.0 0.0"/>
                <mass value="0.30"/>
                <inertia
                        ixx="0.003735" ixy="0.0" ixz="0.0"
                        iyy="0.01391" iyz="0.0"
                        izz="0.01355"/>
            </inertial>
        </link>

        <joint name="${prefix}_JUpperArm" type="revolute">
            <origin rpy="0 0 0" xyz="0.0545 0.0 0.0"/>
            <parent link="${prefix}_LShoulderRx"/>
            <child link="${prefix}_LUpperArm"/>
            <axis xyz="0 1 0"/>
            <dynamics damping="${damping}" friction="${friction}"/>
            <limit effort="${hip_torque_max}" velocity="${hip_torque_max}" lower="${hip_min}"
                   upper="${hip_max}"/>
        </joint>
        <link name="${prefix}_LUpperArm">
            <visual>
            <xacro:if value="${(mirror == True)}">
                <origin rpy="1.57 1.57 0" xyz="0. 0.07 0.02"/>
            </xacro:if>
            <xacro:unless value="${(mirror == False)}">
                <origin rpy="1.57 1.57 0.0" xyz="0 -0.07 0.02"/>
            </xacro:unless>
                <geometry>
                    <mesh filename="package://legged_unitree_description/meshes/$(arg robot_type)/${prefix}_UpperArm.obj"
                            scale="1 1 1"/>
                </geometry>
                <material name="orange"/>
            </visual>
            <collision>
            <xacro:if value="${(mirror == True)}">
                <origin rpy="0 0 0" xyz="${upperarm_x_offset} ${upperarm_y_offset} ${upperarm_z_offset}"/>
            </xacro:if>
            <xacro:unless value="${(mirror == False)}">
                <origin rpy="0 0 0" xyz="${upperarm_x_offset} ${-upperarm_y_offset} ${upperarm_z_offset}"/>
            </xacro:unless>
                <geometry>
                    <cylinder length="${upperarm_length}" radius="${upperarm_radius}"/>
                </geometry>
            </collision>
            <inertial>
                <origin rpy="0 0 0" xyz="0.0 0.0 -0.09"/>
                <mass value="0.37"/>
                <inertia
                        ixx="0.003735" ixy="0.0" ixz="0.0"
                        iyy="0.01391" iyz="0.0"
                        izz="0.01355"/>
            </inertial>
        </link>


        <joint name="${prefix}_JForeArm" type="revolute">
            <origin rpy="0 0 0" xyz="0.0 ${0.068*mirror} -0.195"/>
            <parent link="${prefix}_LUpperArm"/>
            <child link="${prefix}_LForeArm"/>
            <axis xyz="0 1 0"/>
            <dynamics damping="${damping}" friction="${friction}"/>
            <limit effort="${hip_torque_max}" velocity="${hip_torque_max}" lower="${hip_min}"
                   upper="${hip_max}"/>
        </joint>
        <link name="${prefix}_LForeArm">
            <visual>
                <xacro:if value="${(mirror == True)}">
                    <origin rpy="0 0 0" xyz="-0.05 -0.075 0.16"/>
                </xacro:if>
                <xacro:unless value="${(mirror == False)}">
                    <origin rpy="0 0 3.14" xyz="-0.05 0.075 0.16"/>
                </xacro:unless>
                <geometry>
                    <mesh filename="package://legged_unitree_description/meshes/$(arg robot_type)/R_ShoulderRx.obj"
                            scale="1 1 1"/>
                </geometry>
                <material name="orange"/>
            </visual>
            <visual>
                <xacro:if value="${(mirror == True)}">
                    <origin rpy="0 1.570 0.0" xyz="-0.0 -0.0 0.0"/>
                </xacro:if>
                <xacro:unless value="${(mirror == False)}">
                    <origin rpy="0 1.570 0.0" xyz="-0.0 0.0 -0.102"/>
                </xacro:unless>
                <geometry>
                    <mesh filename="package://legged_unitree_description/meshes/$(arg robot_type)/${prefix}_ForeArm2.obj"
                            scale="1 1 1"/>
                </geometry>
                <material name="orange"/>
            </visual>
            <collision>

            <xacro:if value="${(mirror == True)}">
                <origin rpy="0 0 0" xyz="${forearm_x_offset} ${forearm_y_offset} ${forearm_z_offset}"/>
            </xacro:if>
            <xacro:unless value="${(mirror == False)}">
                <origin rpy="0 0 0" xyz="${forearm_x_offset} ${-forearm_y_offset} ${forearm_z_offset}"/>
            </xacro:unless>
                <geometry>
                    <cylinder length="${forearm_length}" radius="${forearm_radius}"/>
                </geometry>
            </collision>
            <inertial>
                <origin rpy="0 0 0" xyz="0.0 0.0 -0.04"/>
                <mass value="0.1"/>
                <inertia
                        ixx="0.003735" ixy="0.0" ixz="0.0"
                        iyy="0.01391" iyz="0.0"
                        izz="0.01355"/>
            </inertial>
        </link>


        <gazebo reference="${prefix}_LShoulderRx">
            <mu1>0.2</mu1>
            <mu2>0.2</mu2>
            <material>Gazebo/DarkGrey</material>
            <kp value="1000000.0"/>
            <kd value="100.0"/>
        </gazebo>
        <gazebo reference="${prefix}_LShoulderRx">
            <mu1>0.2</mu1>
            <mu2>0.2</mu2>
            <material>Gazebo/DarkGrey</material>
            <kp value="1000000.0"/>
            <kd value="100.0"/>
        </gazebo>
        <gazebo reference="${prefix}_LUpperArm">
            <mu1>0.2</mu1>
            <mu2>0.2</mu2>
            <material>Gazebo/DarkGrey</material>
            <kp value="1000000.0"/>
            <kd value="100.0"/>
        </gazebo>
        <xacro:arm_transmission name="${prefix}"/>
    </xacro:macro>
</robot>
